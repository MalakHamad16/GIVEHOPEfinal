<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>زكاة المال - GiveHope</title>

    <!-- الخط الموحّد -->
    <link
      href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="casedetails.css" />
    <link rel="stylesheet" href="zakat.css" />
  </head>
  <body>
    <!-- Navbar -->
    <div id="navbar-placeholder"></div>

    <!-- Page Header -->
    <section class="page-header">
      <h1>زكاة المال</h1>
      <p>
        ﴿ خُذْ مِنْ أَمْوَالِهِمْ صَدَقَةً تُطَهِّرُهُمْ وَتُزَكِّيهِمْ بِهَا ﴾
      </p>
    </section>

    <main>
      <div class="hero-card">
        <h1>إخراج الزكاة</h1>
        <a href="donate.html?type=zakat" class="btn">
          <i class="fas fa-hand-holding-usd"></i> أخرج زكاتك الآن
        </a>
      </div>

      <div class="calculator-box">
        <h2>احسب زكاتك</h2>
        <form id="zakatForm">
          <!-- اختيار العملة -->
          <div class="form-group">
            <label for="currency">اختر العملة</label>
            <select id="currency">
              <option value="ILS" data-symbol="₪">شيكل</option>
              <option value="USD" data-symbol="$">دولار</option>
              <option value="JOD" data-symbol="د.أ">دينار أردني</option>
              <option value="AED" data-symbol="د.إ">درهم إماراتي</option>
            </select>
          </div>

          <div class="form-group">
            <label for="cash">قيمة الأموال النقدية</label>
            <input type="number" id="cash" placeholder="مثال: 10000" min="0" />
          </div>
          <div class="form-group">
            <label for="gold">قيمة الذهب</label>
            <input type="number" id="gold" placeholder="مثال: 5000" min="0" />
          </div>
          <div class="form-group">
            <label for="silver">قيمة الفضة</label>
            <input type="number" id="silver" placeholder="مثال: 2000" min="0" />
          </div>
          <div class="form-group">
            <label for="investments">الاستثمارات والأسهم</label>
            <input
              type="number"
              id="investments"
              placeholder="مثال: 15000"
              min="0"
            />
          </div>
          <button type="submit" class="btn" style="width: 100%">
            <i class="fas fa-calculator"></i> احسب الزكاة
          </button>
        </form>
      </div>
    </main>

    <!-- بوكس النتيجة المنبثق -->
    <div class="overlay" id="overlay"></div>
    <div class="result-popup" id="resultPopup"></div>

    <!-- Footer -->
    <div id="footer-placeholder"></div>

    <!-- تحميل المكونات -->
    <script>
      function loadHTML(id, file) {
        fetch(file)
          .then((res) => res.text())
          .then((html) => (document.getElementById(id).innerHTML = html))
          .catch((err) => console.error("خطأ في تحميل", file, err));
      }

      document.addEventListener("DOMContentLoaded", () => {
        loadHTML("navbar-placeholder", "navbar.html");
        loadHTML("footer-placeholder", "footer.html");
      });
    </script>

    <!-- سكريبت Navbar -->
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const check = setInterval(() => {
          const toggle = document.getElementById("menuToggle");
          const nav = document.getElementById("navLinks");
          if (toggle && nav) {
            clearInterval(check);
            toggle.onclick = (e) => {
              e.stopPropagation();
              nav.classList.toggle("active");
            };
            document.onclick = (e) => {
              if (!e.target.closest(".navbar")) {
                nav.classList.remove("active");
                document
                  .querySelectorAll(".dropdown")
                  .forEach((d) => d.classList.remove("active"));
              }
            };
            nav.onclick = (e) => e.stopPropagation();
            document.querySelectorAll(".dropdown-toggle").forEach((btn) => {
              btn.onclick = (e) => {
                if (window.innerWidth <= 992) {
                  e.preventDefault();
                  const dropdown = btn.parentElement;
                  dropdown.classList.toggle("active");
                  document.querySelectorAll(".dropdown").forEach((d) => {
                    if (d !== dropdown) d.classList.remove("active");
                  });
                }
              };
            });
            window.onresize = () => {
              if (window.innerWidth > 992) {
                nav.classList.remove("active");
                document
                  .querySelectorAll(".dropdown")
                  .forEach((d) => d.classList.remove("active"));
              }
            };
          }
        }, 100);
      });
    </script>

    <!-- سكريبت حساب الزكاة -->
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const form = document.getElementById("zakatForm");
        const overlay = document.getElementById("overlay");
        const popup = document.getElementById("resultPopup");
        const currencySelect = document.getElementById("currency");

        // نصاب الذهب والفضة بالشيكل
        const GOLD_NISAB_GRAM = 85;
        const SILVER_NISAB_GRAM = 595;
        const GOLD_PRICE_PER_GRAM = 300; // تقديري بالشيكل
        const SILVER_PRICE_PER_GRAM = 4; // تقديري بالشيكل

        const CASH_NISAB = GOLD_NISAB_GRAM * GOLD_PRICE_PER_GRAM;

        form?.addEventListener("submit", (e) => {
          e.preventDefault();
          const currencySymbol =
            currencySelect.selectedOptions[0].dataset.symbol || "";

          const cash = parseFloat(document.getElementById("cash").value) || 0;
          const gold = parseFloat(document.getElementById("gold").value) || 0;
          const silver =
            parseFloat(document.getElementById("silver").value) || 0;
          const investments =
            parseFloat(document.getElementById("investments").value) || 0;

          const totalAssets = cash + gold + silver + investments;

          form.reset();

          let resultHTML = "";
          if (totalAssets < CASH_NISAB) {
            // في حال لم يكن المبلغ بلغ النصاب
            resultHTML = `
            <h3>لا تجب عليك الزكاة</h3>
            <p style="color: #e74c3c; margin: 1rem 0; font-size: 1.1rem;">
              مجموع أموالك (<strong>${currencySymbol}${totalAssets.toFixed(
              2
            )}</strong>) 
              أقل من نصاب الزكاة (<strong>${currencySymbol}${CASH_NISAB.toLocaleString()}</strong>).
            </p>
            <p>لا يُشترط إخراج زكاة حتى يبلغ المال النصاب.</p>
          `;
          } else {
            // بعد حساب الزكاة تظهر رسالة انه المبلغ مناسب وخيار الدفع
            const zakat = totalAssets * 0.025;
            resultHTML = `
            <h3>إجمالي الزكاة المستحقة</h3>
            <div class="total-amount">${currencySymbol}${zakat.toFixed(2)}</div>
            <a href="donate.html?type=zakat" class="btn" style="margin-top: 1rem; display: inline-block;">
              <i class="fas fa-check-circle"></i> ادفع زكاتك الآن
            </a>
          `;
          }

          popup.innerHTML = resultHTML;
          overlay.classList.add("show");
          popup.classList.add("show");
        });

        overlay?.addEventListener("click", () => {
          overlay.classList.remove("show");
          popup.classList.remove("show");
        });
      });
    </script>
    <!-- تحديد نوع الصفحة قبل تحميل الشات بوت -->
    <script>
      // عيّن نوع الصفحة
      window.pageType = "zakat";
    </script>
    <script src="loadChatbot.js"></script>
  </body>
</html>
